<!DOCTYPE html>
<html>
<head>
  <title>Porovnanie údajov z vlastností GeoJSON súborov</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    $(document).ready(function() {
      // Funkcia na načítanie dvoch GeoJSON súborov a porovnanie ich vlastností
      function compareGeoJSON() {
        var file1 = $('#file1')[0].files[0];
        var file2 = $('#file2')[0].files[0];

        if (file1 && file2) {
          var reader1 = new FileReader();
          reader1.onload = function(e) {
            var geojson1 = JSON.parse(e.target.result);

            var reader2 = new FileReader();
            reader2.onload = function(e) {
              var geojson2 = JSON.parse(e.target.result);

              // Porovnanie vlastností
              var properties1 = geojson1.features.map(function(feature) {
                return feature.properties;
              });

              var properties2 = geojson2.features.map(function(feature) {
                return feature.properties;
              });

              // Porovnanie údajov
              var changes = findChanges(properties1, properties2);

              // Zapíšte zmeny do nového GeoJSON súboru
              writeChanges(changes);
            };

            reader2.readAsText(file2);
          };

          reader1.readAsText(file1);
        }
      }

      // Funkcia na hľadanie zmien v údajoch
      function findChanges(properties1, properties2) {
        var changes = [];

        for (var i = 0; i < properties1.length; i++) {
          var property1 = properties1[i];
          var property2 = properties2[i];
          var featureId = i + 1;

          if (property1 && property2) {
            // Porovnanie vlastností jednotlivých prvkov
            for (var key in property1) {
              if (property1.hasOwnProperty(key) && property2.hasOwnProperty(key)) {
                var value1 = property1[key];
                var value2 = property2[key];

                // Porovnanie hodnôt
                if (value1 !== value2) {
                  var change = {
                    featureId: featureId,
                    property: key,
                    oldValue: value1,
                    newValue: value2
                  };
                  changes.push(change);
                }
              }
            }
          }
        }

        return changes;
      }
            

      // Funkcia na zápis zmien do súboru
      function writeChanges(changes) {
        var jsonData = JSON.stringify(changes, null, 2);
        var blob = new Blob([jsonData], { type: 'application/geo+json' });

        var downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = 'changes.geojson';
        downloadLink.click();
      }

      // Spustenie funkcie pri kliknutí na tlačidlo Porovnať
      $('#compareButton').click(compareGeoJSON);
    });
  </script>
</head>
<body>
  <h1>Porovnanie údajov z vlastností GeoJSON súborov</h1>
  <input type="file" id="file1">
  <input type="file" id="file2">
  <button id="compareButton">Porovnať</button>
</body>
</html>
