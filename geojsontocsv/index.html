<!DOCTYPE html>
<html>
<head>
  <title>Konverzia GeoJSON na CSV</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
  <h1>Konverzia GeoJSON na CSV</h1>
  <div>
    <label for="geojsonFile">Vybrať súbor:</label>
    <input type="file" id="geojsonFile" accept=".geojson">
  </div>
  <div>
    <label for="geojsonUrl">Vložiť URL:</label>
    <input type="text" id="geojsonUrl">
  </div>
  <button onclick="convertGeoJSON()">Konvertovať</button>

  <script>
    function convertGeoJSON() {
      const fileInput = document.getElementById('geojsonFile');
      const urlInput = document.getElementById('geojsonUrl');
      const file = fileInput.files[0];
      const url = urlInput.value.trim();

      if (file || url) {
        let reader;
        if (file) {
          reader = new FileReader();
          reader.onload = handleFileRead;
          reader.readAsText(file);
        } else {
          fetch(url)
            .then(response => response.text())
            .then(handleFileRead)
            .catch(error => console.log('Chyba pri načítaní súboru z URL:', error));
        }
      } else {
        console.log('Vyberte súbor alebo vložte URL.');
      }
    }

    function handleFileRead(event) {
      const geojson = JSON.parse(event.target.result);
      const csv = Papa.unparse(geojson.features, {
        delimiter: ',',
        header: true
      });

      // Vytvorenie a stiahnutie CSV súboru
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = getOutputFileName();
      link.click();
    }

    function getOutputFileName() {
      const fileInput = document.getElementById('geojsonFile');
      const urlInput = document.getElementById('geojsonUrl');
      const fileName = fileInput.files[0]?.name || urlInput.value.trim();

      return fileName.replace('.geojson', '.csv');
    }
  </script>
</body>
</html>
