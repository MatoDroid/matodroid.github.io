<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Skenovanie</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        #reader { width: 300px; margin: auto; }
        .hidden { display: none; }
        button { margin: 10px; padding: 10px; font-size: 16px; }
    </style>
</head>
<body>

    <h2>QR skenovanie</h2>
    <p id="scan-status">Skenuj kód batérie</p>
    
    <div id="reader"></div>

    <p><strong>Batéria:</strong> <span id="battery-code">-</span></p>
    <p><strong>Používateľ:</strong> <span id="user-code">-</span></p>
    <p><strong>Vozík:</strong> <span id="cart-code">-</span></p>

    <button id="save-data" class="hidden" onclick="saveData()">Uložiť dáta</button>

    <script>
        let scanStep = 0;
        let scanData = { battery: "", user: "", cart: "" };
        let scanner;

        function startScanner() {
            scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
            scanner.render(handleScan);
        }

        function handleScan(qrText) {
            scanner.clear(); // Dočasne vypni skener
            updateScanStep(qrText);

            // Počkajte 1 sekundu a znova spustite skener (iba ak ešte nie sme na konci)
            if (scanStep < 3) {
                setTimeout(() => {
                    scanner.render(handleScan);
                }, 1000);
            }
        }

        function updateScanStep(qrText) {
            if (scanStep === 0) {
                scanData.battery = qrText;
                document.getElementById("battery-code").innerText = qrText;
                document.getElementById("scan-status").innerText = "Počkajte... Skenuj kód používateľa";
            } else if (scanStep === 1) {
                scanData.user = qrText;
                document.getElementById("user-code").innerText = qrText;
                document.getElementById("scan-status").innerText = "Počkajte... Skenuj kód vozíka";
            } else if (scanStep === 2) {
                scanData.cart = qrText;
                document.getElementById("cart-code").innerText = qrText;
                document.getElementById("scan-status").innerText = "Všetky kódy naskenované!";
                document.getElementById("save-data").classList.remove("hidden");
            }
            scanStep++;
        }

        function saveData() {
            fetch("https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(scanData)
            })
            .then(response => response.text())
            .then(data => alert(data))
            .catch(error => alert("Chyba pri ukladaní: " + error));
        }

        startScanner();
    </script>

</body>
</html>
