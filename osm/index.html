<!DOCTYPE html>
<html>
<head>
  <title>Porovnanie GeoJSON súborov</title>
</head>
<body>
  <h1>Porovnanie GeoJSON súborov</h1>
  <button onclick="runComparison()">Spustiť porovnanie</button>

  <script>
    const fetch = require('node-fetch');
const fs = require('fs');

const oldFilePath = './osm/old.geojson';
const newURL = 'https://minvskaddress.freemap.sk/SK042A526355/source_SK042A526355.geojson';

fetch(newURL)
  .then(response => response.json())
  .then(newData => {
    const oldData = JSON.parse(fs.readFileSync(oldFilePath));

    // Porovnanie dát a vytvorenie GeoJSON s rozdielmi

    const diffGeoJSON = {
      type: 'FeatureCollection',
      features: differences.map(diff => {
        const feature = diff.feature;
        const properties = { type: diff.type };
        if (diff.type === 'Modified') {
          properties.oldFeature = diff.oldFeature;
        }
        return {
          type: 'Feature',
          geometry: feature.geometry,
          properties: properties
        };
      })
    };

    // Uloženie rozdielov do differences.geojson súboru
    fs.writeFileSync('differences.geojson', JSON.stringify(diffGeoJSON, null, 2));
    console.log('Porovnanie dokončené. Nájdené rozdiely boli uložené do differences.geojson súboru.');

    // Nahrať nový súbor ako old.geojson
    fs.writeFileSync(oldFilePath, JSON.stringify(newData, null, 2));
    console.log('Nový súbor new.geojson bol úspešne nahradený za old.geojson.');
  })
  .catch(error => {
    console.log('Chyba pri načítaní nového GeoJSON súboru: ' + error.message);
  });
        
        // Nahrať nový súbor ako old.geojson
        fetch('http://www.example.com/new.geojson')
          .then(response => response.json())
          .then(newData => {
            fetch('save-old.php', {
              method: 'POST',
              body: JSON.stringify(newData)
            })
              .then(response => {
                if (response.ok) {
                  console.log('Nový súbor new.geojson bol úspešne nahradený za old.geojson.');
                } else {
                  throw new Error('Chyba pri ukladaní nového súboru.');
                }
              })
              .catch(error => {
                console.log('Chyba: ' + error.message);
              });
          })
          .catch(error => {
            console.log('Chyba pri načítaní nového GeoJSON súboru: ' + error.message);
          });
      })
      .catch(error => {
        console.log('Chyba: ' + error.message);
      });
    }
  </script>
</body>
</html>
