<!DOCTYPE html>
<html>
<head>
  <title>Porovnanie GeoJSON súborov</title>
</head>
<body>
  <h1>Porovnanie GeoJSON súborov</h1>
  <button onclick="runComparison()">Spustiť porovnanie</button>

  <form id="saveForm" style="display: none;">
    <label for="filePath">Umiestnenie súboru:</label>
    <input type="text" id="filePath" name="filePath" placeholder="Názov súboru s rozdielmi">
    <button type="submit">Uložiť</button>
  </form>

  <script>
    function runComparison() {
      const oldFilePath = './MINV_21052023.geojson';
      const newFilePath = './MINV_02062023.geojson';

      fetch(newFilePath)
        .then(response => response.json())
        .then(newData => {
          fetch(oldFilePath)
            .then(response => response.json())
            .then(oldData => {
              // Porovnanie dát a vytvorenie GeoJSON s rozdielmi
              const differences = compareGeoJSON(oldData, newData);

              const diffGeoJSON = {
                type: 'FeatureCollection',
                features: differences.map(diff => {
                  const feature = diff.feature;
                  const properties = { type: diff.type };
                  if (diff.type === 'Modified') {
                    properties.oldFeature = diff.oldFeature;
                  }
                  return {
                    type: 'Feature',
                    geometry: feature.geometry,
                    properties: properties
                  };
                })
              };

              // Zobrazenie formulára na výber umiestnenia pre uloženie súboru
              const saveForm = document.getElementById('saveForm');
              saveForm.style.display = 'block';
              saveForm.onsubmit = function(event) {
                event.preventDefault();
                const filePath = document.getElementById('filePath').value;
                const fileName = filePath.endsWith('.geojson') ? filePath : filePath + '.geojson';

                // Uloženie rozdielov do zvoleného umiestnenia
                const diffFileContent = JSON.stringify(diffGeoJSON, null, 2);
                const diffBlob = new Blob([diffFileContent], { type: 'application/json' });
                const diffURL = URL.createObjectURL(diffBlob);
                const downloadLink = document.createElement('a');
                downloadLink.href = diffURL;
                downloadLink.download = fileName;
                downloadLink.click();
              };
            })
            .catch(error => {
              console.log('Chyba pri načítaní existujúceho GeoJSON súboru: ' + error.message);
            });
        })
        .catch(error => {
          console.log('Chyba pri načítaní nového GeoJSON súboru: ' + error.message);
        });
    }

    function compareGeoJSON(oldData, newData) {
        // Implementujte porovnanie dát a vráťte pole rozdielov
        // Vaša implementácia porovnania dát
  
        // Príklad jednoduchého porovnania v tejto ukážke
        const differences = [];
  
        oldData.features.forEach(oldFeature => {
          const newFeature = newData.features.find(newFeat => newFeat.id === oldFeature.id);
  
          if (!newFeature) {
            differences.push({ type: 'Deleted', feature: oldFeature });
          } else if (JSON.stringify(newFeature) !== JSON.stringify(oldFeature)) {
            differences.push({ type: 'Modified', feature: newFeature, oldFeature: oldFeature });
          }
        });
  
        newData.features.forEach(newFeature => {
          const oldFeature = oldData.features.find(oldFeat => oldFeat.id === newFeature.id);
  
          if (!oldFeature) {
            differences.push({ type: 'Added', feature: newFeature });
          }
        });
  
        return differences;
      }
  </script>
</body>
</html>
